{
    "name": "Nightly MQTT Broker",
    "build": {
        "dockerfile": "../Dockerfile"
    },
    "hostRequirements": {
        "cpus": 8,
        "memory": "32gb",
        "storage": "64gb"
    },
    "features": {
        "ghcr.io/devcontainers/features/dotnet:2": {},
        "ghcr.io/devcontainers/features/rust:1": {},
        "ghcr.io/devcontainers/features/go:1": {},
        "ghcr.io/devcontainers/features/azure-cli:1": {
            "extensions": "connectedk8s,k8s-extension,azure-iot-ops"
        }
    },
    "customizations": {
        "vscode": {
            "extensions": [
                "vsciot-vscode.vscode-dtdl",
                "ms-azuretools.vscode-bicep",
                "ms-azuretools.vscode-docker",
                "ms-kubernetes-tools.vscode-kubernetes-tools"
            ]
        },
        "settings": {
            "scm.repositories.visible": true,
            "scm.alwaysShowRepositories": true,
            "scm.defaultViewMode": "tree",
            "files.trimTrailingWhitespace": true,
            "files.trimFinalNewlines": true,
            "telemetry.telemetryLevel": "off",
            "redhat.telemetry.enabled": false
        }
    },
    "containerEnv": {
        "CLUSTER_NAME": "${localEnv:CODESPACE_NAME}",
        "SESSION": "${localEnv:CODESPACE_VSCODE_FOLDER}/.session",
        "DOTNET_CLI_TELEMETRY_OPTOUT": "true"
    },
    "forwardPorts": [
        1883,
        8883,
        8884
    ],
    "waitFor": "postCreateCommand",
    "onCreateCommand": "tools/deployment/initialize-cluster.sh",
    "postCreateCommand": "git pull; tools/deployment/deploy-aio.sh nightly",
    "postStartCommand": "sudo sh -c 'echo 127.0.0.1 aio-broker >> /etc/hosts'"
}