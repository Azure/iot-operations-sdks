---
test-name: CommandExecutorReceivesPseudoDuplicateNonIdempotentRequest_CommandExecuted
description:
  condition: >-
    CommandExecutor receives non-idempotent request that is duplicate except for different topic.
  expect: >-
    CommandExecutor executes command and responds with value from execution not from cache.

prologue:
  executors:
  - idempotent: !!bool false
    request-topic: "mock/{invokerClientId}/test"
    request-responses-map:
      "Test_Request": [ "Test_Response0", "Test_Response1" ]

requires:
- caching

actions:
- action: freeze time
- action: receive request
  correlation-index: 0
  topic: "mock/client1/test"
- action: await publish
  correlation-index: 0
- action: receive request
  correlation-index: 0
  topic: "mock/client2/test"
- action: unfreeze time
- action: await publish
  correlation-index: 0

epilogue:
  publication-count: 2
  published-messages:
  - correlation-index: 0
    topic: "response/mock/test"
    command-status: 200 # OK
  execution-count: 2
...
