---
test-name: CommandExecutorReceivesEquivalentExecutorSpecificIdempotentRequestFromDifferentInvokerWithinTTL_CommandExecuted
description:
  condition: >-
    CommandExecutor receives equivalent executor-specific idempotent request from different Invoker ID within cacheable TTL.
  expect: >-
    CommandExecutor executes command and responds with value from execution not from cache.

prologue:
  executors:
  - request-topic: "mock/{executorId}/test"
    executor-id: "someExecutor"
    idempotent: !!bool true
    cache-ttl: { seconds: 2 }
    request-responses-map:
      "Test_Request": [ "Test_Response0", "Test_Response1" ]

requires:
- caching

actions:
- action: freeze time
- action: receive request
  topic: "mock/someExecutor/test"
  correlation-index: 0
  response-topic: "mock/someExecutor/test/response"
  invoker-index: 0
- action: await publish
  correlation-index: 0
- action: receive request
  topic: "mock/someExecutor/test"
  correlation-index: 1
  response-topic: "mock/someExecutor/test/response"
  invoker-index: 1
- action: unfreeze time
- action: await publish
  correlation-index: 1

epilogue:
  subscribed-topics:
  - "mock/someExecutor/test"
  published-messages:
  - correlation-index: 0
    payload: "Test_Response0"
  - correlation-index: 1
    payload: "Test_Response1"
  execution-count: 2
...
