# Message Metadata

MQTT messages will include some system and user properties to define metadata values that will help with flow control.

## Telemetry Metadata

### Telemetry Message

|Property|Required|Type|Key|Protocol Versions|Description|
|--------|--------|----|---|-----------------|-----------|
|`ContentType`|no|system|||String value to specify the binary format used in the payload, e.g., `application/json` or `application/protobuf`. When deserializing the message it must match the configured serializer.|
|`FormatIndicator`|yes|system||| 1 for character data (as JSON), 0 for unspecified.|
|`MessageExpiry`|no|system|||The publish message can include an expiry time.|
|`CorrelationData`|no|system|||A unique identifier for the message, must be GUID represented as a `byte[16]`|
|`SourceId`|yes in Protocol Version 2.X|user|`__srcId`|1.1, 2.0|String represening an identifier of the telemetry sender.|
|`ProtocolVersion`|no|user|`__protVer`|1.0, 1.1, 2.0| The protocol version of the message. If not provided, a protocol version of 1.0 is assumed by the telemetry receiver. |

### CloudEvents Header

Telemetry messages can include  [CloudEvents](https://github.com/cloudevents/spec/blob/main/cloudevents/spec.md) as defined by the [CloudEvents MQTT bindings](https://github.com/cloudevents/spec/blob/main/cloudevents/bindings/mqtt-protocol-binding.md), as we are only targeting MQTT5 we will use the [Binary Content Mode](https://github.com/cloudevents/spec/blob/main/cloudevents/bindings/mqtt-protocol-binding.md#31-binary-content-mode).

#### CloudEvents Properties

We will use the next properties

|Name|Required|Sample Value|Notes|
|---|--|--|--|
|`specversion`|yes||1.0| fixed |
|`type`|yes|ms.aio.telemetry| Defaults to ms.aio.telemetry, overridable by the user |
|`source`|yes|aio://mycluster/myoven| The origin of the event|
|`id`|yes|A234-1234-1234| Unique identifier of the message, produced by the TelemetrySender as a Guid|
|`subject`|no|aio/myoven/telemetry/temperature| The MQTT topic where the message was sent. Provided by the TelemetrySender.|
|`time`|no|2018-04-05T17:31:00Z| Time when the message was produced, UTC. Provided by the TelemetrySender.|
|`datacontenttype`|no|application/json| The content type of the message, obtained from the serializer|
|`dataschema`|no|sr://fabrikam-schemas/123123123234234234234234#1.0.0| Uri to resolve the schema|

## Command Metadata

### Request Message

|Property|Required|Type|Key|Protocol Versions|Description|
|--------|--------|----|---|-----------------|-----------|
|`ContentType`|no|system|||String value to specify the binary format used in the payload, e.g., `application/json`, `application/protobuf`, or `application/avro`. When deserializing the message it must match the configured serializer.|
|`FormatIndicator`|yes|system||| 1 for character data (as JSON), 0 for unespecified.|
|`CorrelationData`|yes|system|||A unique identifier for the request, must be GUID represented as a `byte[16]`. Correlation data is generated by the invoker and used to correlate responses.|
|`ResponseTopic`|yes|system|||String with the topic used to receive the response.|
|`MessageExpiry`|no|system|||The publish message can include an expiry time.|
|`Timestamp`|no|user|`__ts`|1.0, 1.1, 2.0|A hybrid clock (HLC) value that can be used to identify the time when the message was produced.|
|`FencingToken`|no|user|`__ft`|1.0, 1.1, 2.0|A hybrid clock (HLC) value that can be used to protect the object of the request from conflicting updates.|
|`InvokerClientId`|yes in Protocol Version 1.X|user|`__invId`|1.0, 1.1|String represening the MQTT client ID used bn the invoker.|
|`SourceId`|yes in Protocol Version 2.X|user|`__srcId`|1.1, 2.0|String represening an identifier of the command invoker.|
|`ProtocolVersion`|no|user|`__protVer`|1.0, 1.1, 2.0| The protocol version of the request. If not provided, a protocol version of 1.0 is assumed by the receiving executor.|

### Response Message

|Property|Required|Type|Key|Protocol Versions|Description|
|--------|--------|----|---|-----------------|-----------|
|`ContentType`|no|system|||String value to specify the binary format used in the payload, e.g., `application/json`, `application/protobuf`, or `application/avro`. When deserializing the message it must match the configured serializer.|
|`FormatIndicator`|yes|system||| 1 for character data (as JSON), 0 for unespecified.|
|`CorrelationData`|yes|system|||As byteArray. The server will apply the value from the request message|
|`MessageExpiry`|no|system|||The publish message can include an expiry time.|
|`Timestamp`|no|user|`__ts`|1.0, 1.1, 2.0|A hybrid clock (HLC) value that can be used to identify the time when the message was produced.|
|`Status`|yes|user|`__stat`|1.0, 1.1, 2.0|String with an HTTP status code, `200` means success, higher values are used for errors.|
|`StatusMessage`|no|user|`__stMsg`|1.0, 1.1, 2.0|String with the error message.|
|`IsApplicationError`|no|user|`__apErr`|1.0, 1.1, 2.0|String with value `true` if an error is at the application level.|
|`InvalidPropertyName`|no|user|`__propName`|1.0, 1.1, 2.0|String identifying the name of a property that is missing or has an invalid value.|
|`InvalidPropertyValue`|no|user|`__propVal`|1.0, 1.1, 2.0|String indicating the value of a property that is invalid.|
|`ProtocolVersion`|no|user|`__protVer`|1.0, 1.1, 2.0| The protocol version of the response. If not provided, a protocol version of 1.0 is assumed by the receiving invoker. |
|`SupportedProtocolMajorVersion`|no|user|`__supProtMajVer`|1.0, 1.1, 2.0| A space separated list of protocol major versions that the executor supports. Only provided if the request provided an unsupported protocol version. |
|`RequestProtocolVersion`|no|user|`__requestProtVer`|1.0, 1.1, 2.0| The full protocol version of the request that was rejected because it was unsupported by the executor. Only provided if the request provided an unsupported protocol version. |
